wu:
  extends:
    file: common.yml
    service: wu
  links:
    - mongo
    - redislayers
    - redisstats
    - redistemp
    - redistokens
    - postgis
  environment:
    SYSTEMAPIC_PRODMODE: 'false'
  working_dir: /systemapic/dev # double switch for prodmode; todo: move into start.sh script somehow, and keep only bool
  volumes_from:
    - data_store_dev_common

pile: 
  extends:
    file: common.yml
    service: pile
  links: 
    - wu
    - mongo
    - redislayers
    - redisstats
    - redistokens
    - redistemp
    - postgis
  environment:
    SYSTEMAPIC_PRODMODE: 'false'
  volumes_from:
    - data_store_dev_common

nginx:
  extends:
    file: common.yml
    service: nginx
  links: 
    - pile
    - wu


# REDIS
# -----
# - based on redis service in common.yml
# - services differ only in stores and config
# store for layers
redislayers:
  extends:
    file: common.yml
    service: redis
  volumes_from:
    - redis_store_dev
  command: "redis-server /systemapic/config/redis.layers.conf"

# store for statistics
redisstats:
  extends:
    file: common.yml
    service: redis
  volumes_from:
    - redis_stats_store_dev
  command: "redis-server /systemapic/config/redis.stats.conf"

# store for access tokens
redistokens:
  extends:
    file: common.yml
    service: redis
  volumes_from:
    - store_dev_redis_tokens
  command: "redis-server /systemapic/config/redis.tokens.conf"

# ephemeral 
redistemp:
  extends:
    file: common.yml
    service: redis
  command: "redis-server /systemapic/config/redis.temp.conf"

# store for web-server models
mongo: 
  extends:
    file: common.yml
    service: mongo
  volumes_from:
    - mongo_store_dev

# store for geodata
postgis:
  image: systemapic/postgis:latest
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config
  volumes_from:
    - postgis_store_dev
  command: ./start.sh

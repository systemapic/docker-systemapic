wu:
  extends:
    file: common.yml
    service: wu
  links:
    - mongo
    - redislayers
    - redisstats
    - redistemp
    - redistokens
    - postgis
  environment:
    SYSTEMAPIC_PRODMODE: 'false'
  working_dir: /systemapic/dev # double switch for prodmode; todo: move into start.sh script somehow, and keep only bool
  volumes_from:
    - data_store_dev_common

pile: 
  extends:
    file: common.yml
    service: pile
  links: 
    - wu
    - mongo
    - redislayers
    - redisstats
    - redistokens
    - redistemp
    - postgis
  environment:
    SYSTEMAPIC_PRODMODE: 'false'
  volumes_from:
    - data_store_dev_common

nginx:
  extends:
    file: common.yml
    service: nginx
  links: 
    - pile
    - wu

postgis:
  image: systemapic/postgis:latest
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config
  volumes_from:
    - postgis_store_dev
  command: ./start.sh

# todo: base all redis on single image; config stored elsewhere
redislayers:
  image: systemapic/redis:layers
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config
  volumes_from:
    - redis_store_dev

redisstats:
  image: systemapic/redis:stats
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config
  volumes_from:
    - redis_stats_store_dev

redistemp:
  image: systemapic/redis:kue
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config

redistokens:
  image: systemapic/redis:tokens
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config
  volumes_from:
    - store_dev_redis_tokens

mongo: 
  image: systemapic/mongo:latest
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config
  volumes_from:
    - mongo_store_dev

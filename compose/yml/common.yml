# The Systemapic Server
wu:
  image: systemapic/wu:latest
  # domain env set from env on localhost
  environment:
    SYSTEMAPIC_DOMAIN: ${SYSTEMAPIC_DOMAIN}
    SYSTEMAPIC_PRODMODE: 'true'
  working_dir: /systemapic/prod # todo: remove (currently needed for doing `docker run ... grunt test`, but can be fixed with `./test.sh` script, or something better)
  # local dev code is added to /systemapic/dev; prod copy is cloned by build.sh to /systemapic/prod
  # config folder from localhost is mounted on /systemapic/config
  volumes:
    - /docks/modules/wu:/systemapic/dev 
    - /docks/config/${SYSTEMAPIC_DOMAIN}:/systemapic/config

pile: 
  image: systemapic/pile:latest
  environment:
    SYSTEMAPIC_DOMAIN: ${SYSTEMAPIC_DOMAIN}
    SYSTEMAPIC_PRODMODE: 'true'
  volumes:
    - /docks/config/${SYSTEMAPIC_DOMAIN}:/systemapic/config
    - /docks/modules/pile:/systemapic/dev # local dev copy is added to /dev, prod copy is cloned by build.sh 

nginx:
  image: systemapic/nginx:latest
  ports:
    - 443:443
    - 80:80
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config

redis:
  image: redis:latest
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config

mongo: 
  image: systemapic/mongo:latest
  volumes:
    - /docks/config/dev.systemapic.com:/systemapic/config

# postgis:
#   image: systemapic/postgis:latest
#   command: ./start.sh

